pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
local x,y=16,16
local shades={}
function _init()
	for i=0,15 do
	 for j=0,15 do
	 	shades[i+16*j]=sget(9,i)+16*sget(9,j)
	 end
	end
end
function _update()
	local dx,dy=0,0
	if(btn(0)) dx=-1
	if(btn(1)) dx=1
	if(btn(2)) dy=-1
	if(btn(3)) dy=1
	x+=dx
	y+=dy
end

function _draw()
	cls(1)
	circfill(64,64,20,6)
	
	--rectfillt(33+x,56+y,67+x,89+y)
 circfillt(33+x,56+y,33)
 
	fillp(0xa5a5)
	--rect(33+x,56+y,67+x,89+y,0x87)
	fillp()
	
	print(stat(1).."%",2,2,7)
end

function rectfillt_base(x0,y0,x1,y1)
	for j=y0,y1 do
		for i=x0,x1 do
			local c=pget(i,j)
			pset(i,j,sget(9,c))
		end
 end
end

function rectfillt(x0,y0,x1,y1)
	x0,x1=max(flr(x0)),min(flr(x1),127)
	
	for j=max(y0),min(y1,127) do
		linet(x0,j,x1)
 end
end

function circfillt(x0,y0,r)
	if(r==0) return
 local x,y,dx,dy=flr(r),0,1,1
 r*=2
 local err=dx-r

	-- avoid overdraw
	local strips={}	
 while x>=y do
		strips[y]=x
		strips[x]=y
				
	 if err<=0 then
   y+=1
   err+=dy
   dy+=2
		end
		if err>0 then
   x-=1
   dx+=2
   err+=dx-r
		end
	end
	for k,v in pairs(strips) do
		linet(x0-v,y0+k,x0+v)
	 if(k!=0)linet(x0-v,y0-k,x0+v)
	end
end

function linet(x0,y0,x1)
 -- odd?
 if band(x0,0x1)==1 then
 	pset(x0,y0,shades[pget(x0,y0)])
 	-- move to even boundary
 	x0+=1
 end
 if x1%2==0 then
 	-- move to even boundary
 	pset(x1,y0,shades[pget(x1,y0)])
 	x1-=1
 end 

	local mem=0x6000+shl(y0,6)+shr(x0,1)
	for i=1,shr(x1-x0+1,1) do
		poke(mem,shades[peek(mem)])
	 mem+=1
	end
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770003b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000490000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700560000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000670000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000870000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000009a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bf0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000f70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
